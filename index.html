<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 F1 è»ŠéšŠæœ€çµ‚æ’åé æ¸¬</title>
    <!-- è¼‰å…¥ Tailwind CSS æ¡†æ¶ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è¼‰å…¥ html2canvas ä»¥å¯¦ç¾æˆªåœ–åŠŸèƒ½ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- ä½¿ç”¨ Inter å­—é«” -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* æ‡‰ç”¨å­—é«” */
        body { font-family: 'Inter', sans-serif; }
        /* è¨­ç½®æ‹–æ›³æ¨£å¼ */
        .drag-active { 
            opacity: 0.95; 
            /* *** ä¿®æ­£: ç§»é™¤ scaleï¼Œä»¥ç¢ºä¿æ¸¸æ¨™å’Œå¡ç‰‡ä¸­å¿ƒå®Œç¾å°é½Š *** */
            /* transform: scale(1.05); */ 
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2); 
            cursor: grabbing !important; 
        }
        .drop-target { transition: all 0.2s ease-in-out; }
        
        /* NEW: æµ®å‹•æ¨£å¼ - ç”¨æ–¼å¡ç‰‡è¢«æ‹¿èµ·æ™‚ */
        .is-floating {
            position: fixed !important;
            z-index: 1000;
        }

        /* è»ŠéšŠå¡ç‰‡åŸºç¤æ¨£å¼ */
        .team-card { 
            cursor: grab; 
            transition: transform 0.1s, box-shadow 0.1s; 
            display: flex !important;
            align-items: center;
            justify-content: flex-start; 
            /* é—œéµï¼šé˜²æ­¢æ‰‹æ©Ÿä¸Šæ‹–æ›³è®Šæˆé¸å–æ–‡å­—å’Œé›»è…¦ç‰ˆæ‹–æ›³æŠ–å‹• */
            -webkit-user-select: none;
            user-select: none;
            touch-action: none;
        }
        .team-card:active { transform: scale(1.02); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }

        /* é‡å°æˆªåœ–æ™‚éœ€è¦éš±è—çš„å…ƒç´  */
        .hidden-on-screenshot {
            display: flex;
        }
        .hidden-on-screenshot.hide {
            display: none !important;
        }
        
        /* å…§å®¹å€å¡Šå®¹å™¨ï¼šç¢ºä¿æ©«å‘æ“´å±• */
        .team-info-container {
            display: flex;
            align-items: center;
            flex-grow: 1; 
            min-width: 0; 
            /* ç¢ºä¿é€™å€‹å…§å®¹å®¹å™¨åœ¨çˆ¶å…ƒç´ ï¼ˆå¡ç‰‡ï¼‰å…§ä¸æœƒæº¢å‡º */
            overflow: hidden; 
        }

        /* èª¿æ•´è»ŠéšŠåç¨±å’Œè»Šæ‰‹è³‡è¨Šçš„ä½ˆå±€ï¼šå‚ç›´ (column) */
        .team-info {
            display: flex;
            flex-direction: column; /* å‚ç›´æ’åˆ— */
            align-items: flex-start; /* å·¦å°é½Š */
            flex-grow: 1;
            min-width: 0; 
        }
        
        /* ç¢ºä¿è»Šæ‰‹åç¨±å¯ä»¥è‡ªç”±æ›è¡Œï¼Œä¸¦æ¸›å°‘é–“è·ï¼Œä½¿å…¶å‚ç›´æ’åˆ—æ›´ç·Šæ¹Š */
        .driver-names {
            white-space: normal; /* å…è¨±æ›è¡Œ */
            margin-left: 0; /* ç§»é™¤æ°´å¹³é–“éš” */
            line-height: 1.2; /* ç¸®å°è¡Œé«˜ */
        }
        
        .driver-names span {
            display: block; /* ç¢ºä¿æ¯å€‹è»Šæ‰‹åå­—ä½”ä¸€è¡Œ */
        }
        
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4 sm:p-8">

    <!-- é€™æ˜¯æˆªåœ–ç›®æ¨™å€åŸŸ -->
    <div class="max-w-7xl mx-auto" id="capture-target"> 
        <h1 class="text-4xl sm:text-5xl font-extrabold text-gray-900 mb-2 text-center">
            2026 F1 è»ŠéšŠæœ€çµ‚æ’åé æ¸¬
        </h1>
        <p class="text-center text-gray-600 mb-8 sm:mb-12">
            è«‹å°‡å³å´çš„è»ŠéšŠæ‹–æ›³è‡³å·¦å´çš„æ’åå€å¡Š (1st - 11th)
        </p>

        <!-- ä¸»å¸ƒå±€ï¼šæ’åå€åŸŸ (å·¦) èˆ‡è»ŠéšŠåº« (å³) -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

            <!-- æ’åå€åŸŸ (å·¦å´) -->
            <div id="ranking-container" class="lg:col-span-2 bg-white p-4 sm:p-6 rounded-xl shadow-lg">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">æœ€çµ‚é æ¸¬æ’å (1st - 11th)</h2>
                
                <!-- åœ¨å°è¢å¹•ä¸Šå°‡æ’åç©ºä½èª¿æ•´ç‚ºå–®æ¬„ -->
                <div id="ranking-slots" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- æ’åç©ºä½å°‡ç”± JavaScript ç”Ÿæˆ -->
                </div>
            </div>

            <!-- è»ŠéšŠåº« (å³å´) -->
            <div class="lg:col-span-1 bg-white p-4 sm:p-6 rounded-xl shadow-lg flex flex-col h-full">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">æœªæ’åè»ŠéšŠ (Unranked Teams)</h2>
                
                <div id="unranked-teams" class="flex flex-col space-y-3 flex-grow">
                    <!-- è»ŠéšŠå¡ç‰‡å°‡ç”± JavaScript ç”Ÿæˆ -->
                </div>

                <!-- æŒ‰éˆ•å€ -->
                <div class="mt-6 pt-4 border-t flex flex-col space-y-2 hidden-on-screenshot">
                    <button onclick="capturePrediction()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-4 rounded-lg shadow-md transition duration-150">
                        ğŸ’¾ ä¸‹è¼‰é æ¸¬åœ–ç‰‡ (æˆªåœ–)
                    </button>
                    <button onclick="resetRanking()" class="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-3 px-4 rounded-lg shadow-md transition duration-150">
                        é‡è¨­æ’å
                    </button>
                    <button onclick="savePrediction()" class="w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-3 px-4 rounded-lg shadow-md transition duration-150">
                        å„²å­˜æˆ‘çš„é æ¸¬ (ç€è¦½å™¨)
                    </button>
                </div>

                <!-- è¨Šæ¯é¡¯ç¤ºå€ -->
                <div id="message-box" class="mt-4 p-3 text-sm rounded-lg text-center hidden"></div>

            </div>
        </div>
    </div>
    <!-- æˆªåœ–ç›®æ¨™å€åŸŸçµæŸ -->

    <script>
        // F1 2026 é æœŸåƒè³½è»ŠéšŠåˆ—è¡¨
        const TEAMS = [
            { id: 'RBR', name: 'Red Bull Racing', color: 'bg-blue-600', text: 'text-white', logoText: 'R', drivers: 'Max Verstappen & Isack Hadjar' },
            { id: 'MER', name: 'Mercedes', color: 'bg-gray-400', text: 'text-black', logoText: 'M', drivers: 'George Russell & Kimi Antonelli' },
            { id: 'FER', name: 'Ferrari', color: 'bg-red-600', text: 'text-white', logoText: 'F', drivers: 'Charles Leclerc & Lewis Hamilton' },
            { id: 'MCL', name: 'McLaren', color: 'bg-orange-500', text: 'text-white', logoText: 'M', drivers: 'Lando Norris & Oscar Piastri' },
            { id: 'AST', name: 'Aston Martin', color: 'bg-green-700', text: 'text-white', logoText: 'A', drivers: 'Fernando Alonso & Lance Stroll' },
            { id: 'ALP', name: 'Alpine', color: 'bg-pink-700', text: 'text-white', logoText: 'A', drivers: 'Pierre Gasly & Franco Colapinto' },
            { id: 'AUD', name: 'Audi', color: 'bg-white', text: 'text-black', border: 'border border-gray-300', logoText: 'A', drivers: 'Nico Hulkenberg & Gabriel Bortoleto' }, // Kick Sauber è½‰å‹
            { id: 'WIL', name: 'Williams Racing', color: 'bg-blue-900', text: 'text-white', logoText: 'W', drivers: 'Alex Albon & Carlos Sainz' },
            { id: 'HAA', name: 'Haas', color: 'bg-gray-800', text: 'text-white', logoText: 'H', drivers: 'Esteban Ocon & Ollie Bearman' },
            { id: 'RB', name: 'Racing Bulls', color: 'bg-red-400', text: 'text-white', logoText: 'R', drivers: 'Liam Lawson & Arvid Lindblad' },
            { id: 'CAD', name: 'Cadillac', color: 'bg-black', text: 'text-white', logoText: 'C', drivers: 'Valtteri Bottas & Sergio Perez' } // æ–°è»ŠéšŠ
        ];

        const RANKING_COUNT = 11; 
        
        // --- é€šç”¨æ‹–æ›³ç‹€æ…‹å’Œé‚è¼¯ (Touch & Mouse) ---
        let draggedCard = null;
        let currentDropTarget = null;
        let isDragging = false;
        let offsetX = 0;
        let offsetY = 0;
        let originalParent = null;
        let originalIndex = -1; // è¨˜éŒ„å¡ç‰‡åœ¨çˆ¶å…ƒç´ ä¸­çš„åŸå§‹ç´¢å¼•

        document.addEventListener('DOMContentLoaded', () => {
            initializeApp();
            // ç›£è½å…¨å±€çš„ mouseup å’Œ touchendï¼Œä»¥çµæŸæ‹–æ›³
            document.addEventListener('mouseup', endDrag);
            document.addEventListener('touchend', endDrag);
            document.addEventListener('mousemove', moveDrag);
            document.addEventListener('touchmove', moveDrag);
        });

        /**
         * ç²å–åº§æ¨™ä¸‹çš„æœ‰æ•ˆæ”¾ç½®ç›®æ¨™ (æ’åç©ºä½æˆ–æœªæ’åå€)
         */
        function getTarget(x, y) {
            if (draggedCard) draggedCard.style.display = 'none'; // æš«æ™‚éš±è—æ‹–æ›³å…ƒç´ 
            let element = document.elementFromPoint(x, y);
            if (draggedCard) draggedCard.style.display = 'flex'; // æ¢å¾©å¯è¦‹

            // å°‹æ‰¾æœ€è¿‘çš„ drop-target æˆ– unranked-teams å€å¡Š
            while (element) {
                if (element.classList.contains('drop-target') || element.id === 'unranked-teams') {
                    return element;
                }
                element = element.parentElement;
            }
            return null;
        }

        /**
         * å°‡å¡ç‰‡æŒ‰ TEAMS é™£åˆ—ä¸­çš„åŸå§‹é †åºæ’å…¥åˆ°æœªæ’åå€ã€‚
         * @param {HTMLElement} card - è¦æ’å…¥çš„è»ŠéšŠå¡ç‰‡
         */
        function insertCardIntoUnrankedSorted(card) {
            const cardOriginalIndex = TEAMS.findIndex(t => t.id === card.id);
            const unrankedContainer = document.getElementById('unranked-teams');
            const unrankedChildren = Array.from(unrankedContainer.children).filter(child => child.id !== card.id && child.id !== 'drag-placeholder');

            let insertBeforeNode = null;
            for (let i = 0; i < unrankedChildren.length; i++) {
                const unrankedTeamId = unrankedChildren[i].id;
                const unrankedTeamIndex = TEAMS.findIndex(t => t.id === unrankedTeamId);
                
                // å°‹æ‰¾æ¯”ç•¶å‰å¡ç‰‡åŸå§‹ç´¢å¼•å¤§çš„ç¬¬ä¸€å€‹å¡ç‰‡ä½œç‚ºæ’å…¥é»
                if (unrankedTeamIndex > cardOriginalIndex) {
                    insertBeforeNode = unrankedChildren[i];
                    break;
                }
            }

            // ç¢ºä¿å¡ç‰‡å¾ç•¶å‰ä½ç½®ç§»é™¤ï¼ˆå¦‚æœå®ƒåœ¨ DOM ä¸­ï¼‰
            if (card.parentElement) {
                card.parentElement.removeChild(card);
            }

            if (insertBeforeNode) {
                unrankedContainer.insertBefore(card, insertBeforeNode);
            } else {
                unrankedContainer.appendChild(card); 
            }
        }


        // --- æ‹–æ›³é–‹å§‹é‚è¼¯ (Touch & Mouse) ---
        function startDrag(e, card) {
            // æª¢æŸ¥æ˜¯å¦å·²ç¶“åœ¨æ‹–æ›³æˆ–æ˜¯å¦ç‚ºå¤šé»è§¸æ§
            if (isDragging || (e.touches && e.touches.length !== 1)) return;
            
            // é˜»æ­¢è§¸æ§è¢å¹•é è¨­è¡Œç‚ºï¼ˆä¾‹å¦‚é•·æŒ‰é¸å–æ–‡å­—æˆ–é é¢æ»¾å‹•ï¼‰
            if (e.type.startsWith('touch')) e.preventDefault(); 
            // é˜»æ­¢æ¡Œé¢æ»‘é¼ é¸å–è¡Œç‚º
            if (e.type.startsWith('mouse')) e.preventDefault(); 

            draggedCard = card; 
            isDragging = true;
            draggedCard.classList.add('drag-active');
            
            // NEW: è¨˜éŒ„åŸå§‹çˆ¶å…ƒç´ å’Œç´¢å¼•
            originalParent = card.parentElement;
            originalIndex = Array.from(originalParent.children).indexOf(card);


            // è¨­ç½®ä½ç½®å±¬æ€§ï¼Œé–‹å§‹è¦–è¦ºæ‹–æ›³æ¨¡æ“¬
            draggedCard.classList.add('is-floating'); // ä½¿ç”¨æ–°æµ®å‹•æ¨£å¼
            draggedCard.classList.remove('flex-grow'); // ç§»é™¤ flex-grow ç¢ºä¿å›ºå®šå¯¬åº¦

            draggedCard.style.width = card.offsetWidth + 'px'; // å›ºå®šå¯¬åº¦

            // ç¢ºå®šèµ·å§‹åº§æ¨™å’Œåç§»é‡
            const rect = draggedCard.getBoundingClientRect();
            const clientX = e.clientX !== undefined ? e.clientX : e.touches[0].clientX;
            const clientY = e.clientY !== undefined ? e.clientY : e.touches[0].clientY;
            
            // *** é—œéµä¿®æ­£ï¼šä¸­å¿ƒå°é½Šæ¸¸æ¨™/è§¸æ§é» ***
            offsetX = rect.width / 2; 
            offsetY = rect.height / 2;

            // ç§»å‹•å¡ç‰‡åˆ°è§¸æ§/æ»‘é¼ èµ·å§‹ä½ç½®
            draggedCard.style.left = (clientX - offsetX) + 'px';
            draggedCard.style.top = (clientY - offsetY) + 'px';

            // --- å‰µå»ºä½”ä½ç¬¦ä»¥é˜²æ­¢åˆ—è¡¨è·³å‹• (åƒ…ç•¶å¾æœªæ’åå€æ‹–æ›³æ™‚) ---
            const unrankedContainer = document.getElementById('unranked-teams');
            if (card.parentElement === unrankedContainer) {
                const placeholder = document.createElement('div');
                placeholder.id = 'drag-placeholder';
                
                // è¤‡è£½å¡ç‰‡çš„å°ºå¯¸å’Œå¤–è§€
                const rect = draggedCard.getBoundingClientRect();
                placeholder.style.height = rect.height + 'px';
                placeholder.style.backgroundColor = '#e5e7eb'; 
                placeholder.style.borderRadius = '0.5rem';
                placeholder.style.transition = 'none'; // ç„¡éœ€éæ¸¡
                placeholder.style.marginBottom = '0.75rem'; // Tailwind space-y-3 ç›¸ç•¶æ–¼ mb-3 (0.75rem)
                
                card.parentElement.insertBefore(placeholder, card.nextSibling || card); 
            }
        }

        // --- æ‹–æ›³ç§»å‹•é‚è¼¯ (Touch & Mouse) ---
        function moveDrag(e) {
            if (!isDragging) return;
            
            // é˜»æ­¢è§¸æ§è¢å¹•é è¨­è¡Œç‚ºï¼ˆä¾‹å¦‚é é¢æ»¾å‹•ï¼‰
            if (e.type.startsWith('touch')) e.preventDefault(); 

            const clientX = e.clientX !== undefined ? e.clientX : e.touches[0].clientX;
            const clientY = e.clientY !== undefined ? e.clientY : e.touches[0].clientY;

            // æ›´æ–°å¡ç‰‡ä½ç½®
            draggedCard.style.left = (clientX - offsetX) + 'px';
            draggedCard.style.top = (clientY - offsetY) + 'px';

            // æª¢æŸ¥æ”¾ç½®ç›®æ¨™
            const target = getTarget(clientX, clientY);

            if (target !== currentDropTarget) {
                // é›¢é–‹èˆŠç›®æ¨™
                if (currentDropTarget) {
                    currentDropTarget.classList.remove('bg-gray-200');
                }
                // é€²å…¥æ–°ç›®æ¨™
                if (target) {
                    target.classList.add('bg-gray-200');
                }
                currentDropTarget = target;
            }
        }

        // --- æ‹–æ›³çµæŸé‚è¼¯ (Touch & Mouse) ---
        function endDrag() {
            if (!isDragging) return;

            isDragging = false;
            
            // æ¢å¾©è¦–è¦ºç‹€æ…‹
            draggedCard.classList.remove('drag-active');
            
            // --- ç§»é™¤ä½”ä½ç¬¦ ---
            const placeholder = document.getElementById('drag-placeholder');
            if (placeholder) {
                placeholder.remove();
            }

            // å¦‚æœæ‰¾åˆ°æœ‰æ•ˆçš„æ”¾ç½®ç›®æ¨™ï¼ŒåŸ·è¡Œæ”¾ç½®é‚è¼¯
            if (currentDropTarget) {
                currentDropTarget.classList.remove('bg-gray-200');
                executeDrop(draggedCard, currentDropTarget);
            } else {
                // --- é—œéµä¿®æ­£ï¼šå¦‚æœæ‹–æ›³å¤±æ•—ï¼Œå°‡å¡ç‰‡æ’å›åŸå§‹ä½ç½®æˆ–æ’åºä½ç½® ---
                
                // ç¢ºä¿å¡ç‰‡å¾ç•¶å‰ä½ç½®ç§»é™¤ï¼ˆå¦‚æœå®ƒåœ¨ DOM ä¸­ï¼‰
                if (draggedCard.parentElement) {
                    draggedCard.parentElement.removeChild(draggedCard);
                }

                if (originalParent && originalParent.id === 'unranked-teams') {
                    // å¦‚æœä¾†è‡ªæœªæ’åå€ä¸”æ”¾æ‰‹å¤±æ•—ï¼šæ’å›æ’åºä½ç½®
                    insertCardIntoUnrankedSorted(draggedCard);
                } else if (originalParent && originalParent.id.startsWith('rank-')) {
                    // å¦‚æœä¾†è‡ªæ’åå€ä¸”æ”¾æ‰‹å¤±æ•—ï¼šç›´æ¥æ”¾å›è©²æ’åæ¡†
                    originalParent.appendChild(draggedCard);
                } else {
                    // çµ‚æ¥µå‚™ç”¨ï¼šæ”¾åˆ°æœªæ’åå€æœ«å°¾
                    const unrankedContainer = document.getElementById('unranked-teams');
                    unrankedContainer.appendChild(draggedCard);
                }
                showMessage('æ‹–æ›³å–æ¶ˆï¼Œå¡ç‰‡å·²è¿”å›åŸä½ã€‚', 'bg-red-100 text-red-800');
            }

            // é‡ç½®å¡ç‰‡çš„å®šä½æ¨£å¼ï¼Œè®“å®ƒé‡æ–°é€²å…¥æ­£å¸¸çš„æ–‡æª”æµ
            draggedCard.classList.remove('is-floating'); // ç§»é™¤æµ®å‹•æ¨£å¼
            draggedCard.classList.add('flex-grow'); // æ¢å¾© flex-grow
            draggedCard.style.width = 'auto'; 
            draggedCard.style.left = '';
            draggedCard.style.top = '';

            draggedCard = null;
            currentDropTarget = null;
            originalParent = null;
            originalIndex = -1;
        }

        // --- æ ¸å¿ƒæ”¾ç½®é‚è¼¯ ---
        function executeDrop(card, targetSlot) {
            if (targetSlot.id.startsWith('rank-')) {
                // ç›®æ¨™æ˜¯æ’åç©ºä½
                const existingCard = targetSlot.querySelector('.team-card');
                
                if (existingCard && existingCard !== card) {
                    // äº¤æ›é‚è¼¯ï¼šå°‡èˆŠå¡ç‰‡é€å›æœªæ’åå€ï¼Œå°‡æ–°å¡ç‰‡æ”¾å…¥ç©ºä½
                    insertCardIntoUnrankedSorted(existingCard); // ä½¿ç”¨æ’åºæ’å…¥è¼”åŠ©å‡½æ•¸
                    targetSlot.appendChild(card);
                    
                } else if (!existingCard) {
                    // ç©ºä½ï¼šç›´æ¥æ”¾å…¥
                    targetSlot.appendChild(card);
                    
                } else {
                    // æ”¾å›è‡ªå·±çš„ç©ºä½
                    if (card.parentElement !== targetSlot) {
                        targetSlot.appendChild(card);
                    }
                }
            } else if (targetSlot.id === 'unranked-teams') {
                // ç›®æ¨™æ˜¯æœªæ’åå€ (å°‡å¡ç‰‡æ’å›åŸå§‹æ’åºä½ç½®)
                insertCardIntoUnrankedSorted(card); // ä½¿ç”¨æ’åºæ’å…¥è¼”åŠ©å‡½æ•¸
            }
            
            showMessage('æ’åå·²æ›´æ–°ï¼', 'bg-blue-100 text-blue-800');
        }


        /**
         * åˆå§‹åŒ–æ‡‰ç”¨ç¨‹åºï¼šç”Ÿæˆæ’åç©ºä½å’Œè»ŠéšŠå¡ç‰‡
         */
        function initializeApp() {
            createRankingSlots();
            createTeamCards(TEAMS, 'unranked-teams');
            loadPrediction(); // å˜—è©¦å¾æœ¬åœ°å„²å­˜è¼‰å…¥é æ¸¬
        }
        
        /**
         * ç”Ÿæˆæ’åç©ºä½ (1st - 11th)
         */
        function createRankingSlots() {
            const slotsContainer = document.getElementById('ranking-slots');
            const rankSuffixes = ['st', 'nd', 'rd', 'th', 'th', 'th', 'th', 'th', 'th', 'th', 'th'];
            
            for (let i = 1; i <= RANKING_COUNT; i++) {
                const rankText = `${i}${rankSuffixes[i - 1]}`;
                
                const slotDiv = document.createElement('div');
                slotDiv.id = `rank-${i}`;
                slotDiv.className = 'drop-target p-3 bg-gray-100 border-2 border-dashed border-gray-300 rounded-lg flex items-center min-h-[70px] transition-colors';
                slotDiv.innerHTML = `<span class="text-lg font-bold text-gray-500 mr-2 w-12 flex-shrink-0">${rankText}</span>`;

                slotsContainer.appendChild(slotDiv);
            }
        }

        /**
         * ç”Ÿæˆè»ŠéšŠå¡ç‰‡ä¸¦æ’å…¥åˆ°æŒ‡å®šçš„å®¹å™¨
         */
        function createTeamCards(teams, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = ''; 

            teams.forEach(team => {
                const card = document.createElement('div');
                card.id = team.id;
                
                // é—œéµä¿®æ­£ï¼šp-2 (ç¸®å°å…§é‚Šè·) å’Œ flex-grow (å¡«æ»¿å‰©é¤˜ç©ºé–“)
                card.className = `team-card bg-white text-gray-900 ${team.border || ''} p-2 flex-grow rounded-lg shadow-md overflow-hidden`;
                
                const logoBgColor = team.color; 
                const logoTextColor = team.text; 
                
                const logoHtml = `
                    <div class="h-8 w-8 rounded-full flex items-center justify-center border-2 border-transparent ${logoBgColor} ${logoTextColor} shadow-inner flex-shrink-0">
                        <span class="text-sm font-extrabold">
                            ${team.logoText}
                        </span>
                    </div>
                `;
                
                const driversArray = team.drivers.split(' & ');
                const driver1 = driversArray[0] || '';
                const driver2 = driversArray[1] || '';

                card.innerHTML = `
                    <div class="team-info-container space-x-2">
                        ${logoHtml}
                        <div class="team-info gap-1">
                            <span class="text-sm font-bold whitespace-nowrap">${team.name}</span>
                            <div class="driver-names">
                                <span class="text-xs text-gray-500 font-medium block">${driver1}</span>
                                <span class="text-xs text-gray-500 font-medium block">${driver2}</span>
                            </div>
                        </div>
                    </div>
                `;

                card.addEventListener('mousedown', (e) => startDrag(e, card));
                card.addEventListener('touchstart', (e) => startDrag(e, card));
                
                container.appendChild(card);
            });
        }
        
        /**
         * é‡è¨­æ‰€æœ‰æ’åï¼Œå°‡æ‰€æœ‰è»ŠéšŠå¡ç‰‡ç§»å›æœªæ’åå€
         */
        function resetRanking() {
            const allTeams = [...document.querySelectorAll('.team-card')];
            const unrankedContainer = document.getElementById('unranked-teams');
            
            // æŒ‰ç…§åŸå§‹é †åºé‡æ–°æ’åº (ç¢ºä¿é‡è¨­å¾Œé †åºä¸€è‡´)
            const sortedTeams = allTeams.sort((a, b) => {
                const teamA = TEAMS.find(t => t.id === a.id);
                const teamB = TEAMS.find(t => t.id === b.id);
                return TEAMS.indexOf(teamA) - TEAMS.indexOf(teamB);
            });

            sortedTeams.forEach(card => {
                if(card.parentElement) {
                    card.parentElement.removeChild(card);
                }
                unrankedContainer.appendChild(card);
            });

            // æ¸…é™¤æœ¬åœ°å„²å­˜
            localStorage.removeItem('f1_2026_ranking');
            showMessage('æ’åå·²é‡è¨­ã€‚', 'bg-red-100 text-red-800');
        }

        /**
         * å„²å­˜ç›®å‰çš„æ’ååˆ°ç€è¦½å™¨çš„ localStorage
         */
        function savePrediction() {
            const ranking = [];
            for (let i = 1; i <= RANKING_COUNT; i++) {
                const slot = document.getElementById(`rank-${i}`);
                const teamCard = slot.querySelector('.team-card');
                
                if (teamCard) {
                    ranking.push({ rank: i, teamId: teamCard.id });
                } else {
                    ranking.push({ rank: i, teamId: null }); // è¨˜éŒ„ç©ºä½
                }
            }
            
            localStorage.setItem('f1_2026_ranking', JSON.stringify(ranking));
            showMessage('é æ¸¬æ’åå·²å„²å­˜åˆ°æ‚¨çš„ç€è¦½å™¨ï¼', 'bg-green-100 text-green-800');
        }

        /**
         * å¾ localStorage è¼‰å…¥å„²å­˜çš„æ’å
         */
        function loadPrediction() {
            const storedRanking = localStorage.getItem('f1_2026_ranking');
            if (!storedRanking) return;

            const ranking = JSON.parse(storedRanking);
            let teamsToKeep = [...TEAMS.map(t => t.id)]; // æ‰€æœ‰è»ŠéšŠ ID

            ranking.forEach(item => {
                if (item.teamId) {
                    const teamCard = document.getElementById(item.teamId);
                    const targetSlot = document.getElementById(`rank-${item.rank}`);
                    
                    if (teamCard && targetSlot) {
                        if (teamCard.parentElement) {
                            teamCard.parentElement.removeChild(teamCard);
                        }
                        targetSlot.appendChild(teamCard);
                        
                        teamsToKeep = teamsToKeep.filter(id => id !== item.teamId);
                    }
                }
            });

            const unrankedContainer = document.getElementById('unranked-teams');
            unrankedContainer.innerHTML = '';
            const unrankedTeamsData = TEAMS.filter(team => teamsToKeep.includes(team.id));
            createTeamCards(unrankedTeamsData, 'unranked-teams');
            
            showMessage('å·²è¼‰å…¥æ‚¨ä¸Šæ¬¡å„²å­˜çš„æ’åï¼', 'bg-yellow-100 text-yellow-800');
        }

        /**
         * æˆªåœ–ä¸¦ä¸‹è¼‰ç›®å‰çš„é æ¸¬çµæœ
         */
        function capturePrediction() {
            const captureArea = document.getElementById('capture-target');
            const buttonsContainer = document.querySelector('.hidden-on-screenshot');
            
            // 1. éš±è—ä¸æ‡‰å‡ºç¾åœ¨æˆªåœ–ä¸­çš„å…ƒç´  (æŒ‰éˆ•çµ„)
            buttonsContainer.classList.add('hide');
            
            // 2. é¡¯ç¤ºåŠ è¼‰è¨Šæ¯
            showMessage('æ­£åœ¨ç”Ÿæˆåœ–ç‰‡ï¼Œè«‹ç¨å€™...', 'bg-blue-100 text-blue-800');
            
            // 3. ä½¿ç”¨ html2canvas æˆªåœ–
            // è¨­ç½® scale ä»¥æé«˜åœ–ç‰‡è§£æåº¦ï¼Œé©ç”¨æ–¼ç§»å‹•è¨­å‚™
            html2canvas(captureArea, { 
                scale: window.devicePixelRatio * 2, // æé«˜è§£æåº¦
                useCORS: true,
                allowTaint: true 
            }).then(canvas => {
                // 4. å°‡ Canvas è½‰æ›ç‚ºåœ–ç‰‡é€£çµä¸¦ä¸‹è¼‰
                const image = canvas.toDataURL('image/png');
                const link = document.createElement('a');
                link.download = 'F1_2026_Ranking_Prediction.png';
                link.href = image;
                link.click();

                showMessage('é æ¸¬åœ–ç‰‡å·²æˆåŠŸä¸‹è¼‰ï¼', 'bg-green-100 text-green-800');
            }).catch(error => {
                console.error('æˆªåœ–å¤±æ•—:', error);
                showMessage('æˆªåœ–å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç€è¦½å™¨è¨­å®šæˆ–é‡æ–°å˜—è©¦ã€‚', 'bg-red-100 text-red-800');
            }).finally(() => {
                // 5. é‡æ–°é¡¯ç¤ºéš±è—çš„å…ƒç´ 
                buttonsContainer.classList.remove('hide');
            });
        }

        /**
         * é¡¯ç¤ºè¨Šæ¯
         */
        function showMessage(text, className) {
            const msgBox = document.getElementById('message-box');
            msgBox.textContent = text;
            msgBox.className = `mt-4 p-3 text-sm rounded-lg text-center ${className}`;
            msgBox.classList.remove('hidden');
            
            // 5 ç§’å¾Œè‡ªå‹•éš±è—
            setTimeout(() => {
                msgBox.classList.add('hidden');
            }, 5000);
        }
    </script>

</body>
</html>