<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 F1 è»ŠéšŠæœ€çµ‚æ’åé æ¸¬</title>
    <!-- è¼‰å…¥ Tailwind CSS æ¡†æ¶ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è¼‰å…¥ html2canvas ä»¥å¯¦ç¾æˆªåœ–åŠŸèƒ½ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- ä½¿ç”¨ Inter å­—é«” -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* æ‡‰ç”¨å­—é«” */
        body { font-family: 'Inter', sans-serif; }
        
        /* æ‹–æ›³æ™‚çš„è¦–è¦ºæ•ˆæœ */
        .drag-source { 
            opacity: 0.4; 
            box-shadow: none;
            border: 2px dashed #4a4a4a;
        }

        /* æ”¾ç½®ç›®æ¨™çš„è¦–è¦ºæ•ˆæœ */
        .drag-over { 
            background-color: #d1d5db; /* gray-300 */
        }
        .drop-target { transition: all 0.2s ease-in-out; }
        
        /* è»ŠéšŠå¡ç‰‡åŸºç¤æ¨£å¼ */
        .team-card { 
            cursor: grab; 
            transition: transform 0.1s, box-shadow 0.1s; 
            display: flex !important;
            align-items: center;
            justify-content: flex-start; 
            /* é—œéµï¼šå…è¨±åŸç”Ÿæ‹–æ›³ï¼Œä½†é˜²æ­¢ç§»å‹•ç«¯èª¤è§¸é¸å– */
            -webkit-user-select: none;
            user-select: none;
            touch-action: pan-y; /* å…è¨±å‚ç›´æ»¾å‹•ï¼Œä½†é–å®šæ°´å¹³æ‹–æ›³ */
        }
        .team-card:active { transform: scale(1.02); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }

        /* å…§å®¹ä½ˆå±€ */
        .team-info-container {
            display: flex;
            align-items: center;
            flex-grow: 1; 
            min-width: 0; 
            overflow: hidden; 
        }

        /* å‚ç›´æ’åˆ—çš„éšŠåå’Œè»Šæ‰‹ */
        .team-info {
            display: flex;
            flex-direction: column; 
            align-items: flex-start; 
            flex-grow: 1;
            min-width: 0; 
        }
        
        .driver-names {
            white-space: normal; 
            margin-left: 0; 
            line-height: 1.2; 
        }
        
        .driver-names span {
            display: block; 
        }

        /* æˆªåœ–éš±è—å…ƒç´  */
        .hidden-on-screenshot {
            display: flex;
        }
        .hidden-on-screenshot.hide {
            display: none !important;
        }
        
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4 sm:p-8">

    <!-- é€™æ˜¯æˆªåœ–ç›®æ¨™å€åŸŸ -->
    <div class="max-w-7xl mx-auto" id="capture-target"> 
        <h1 class="text-4xl sm:text-5xl font-extrabold text-gray-900 mb-2 text-center">
            2026 F1 è»ŠéšŠæœ€çµ‚æ’åé æ¸¬
        </h1>
        <p class="text-center text-gray-600 mb-8 sm:mb-12">
            è«‹å°‡å³å´çš„è»ŠéšŠæ‹–æ›³è‡³å·¦å´çš„æ’åå€å¡Š (1st - 11th)
        </p>

        <!-- ä¸»å¸ƒå±€ï¼šæ’åå€åŸŸ (å·¦) èˆ‡è»ŠéšŠåº« (å³) -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

            <!-- æ’åå€åŸŸ (å·¦å´) -->
            <div id="ranking-container" class="lg:col-span-2 bg-white p-4 sm:p-6 rounded-xl shadow-lg">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">æœ€çµ‚é æ¸¬æ’å (1st - 11th)</h2>
                
                <!-- åœ¨å°è¢å¹•ä¸Šå°‡æ’åç©ºä½èª¿æ•´ç‚ºå–®æ¬„ -->
                <div id="ranking-slots" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- æ’åç©ºä½å°‡ç”± JavaScript ç”Ÿæˆ -->
                </div>
            </div>

            <!-- è»ŠéšŠåº« (å³å´) -->
            <div class="lg:col-span-1 bg-white p-4 sm:p-6 rounded-xl shadow-lg flex flex-col h-full">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">æœªæ’åè»ŠéšŠ (Unranked Teams)</h2>
                
                <div id="unranked-teams" class="flex flex-col space-y-3 flex-grow">
                    <!-- è»ŠéšŠå¡ç‰‡å°‡ç”± JavaScript ç”Ÿæˆ -->
                </div>

                <!-- æŒ‰éˆ•å€ -->
                <div class="mt-6 pt-4 border-t flex flex-col space-y-2 hidden-on-screenshot">
                    <button onclick="capturePrediction()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-4 rounded-lg shadow-md transition duration-150">
                        ğŸ’¾ ä¸‹è¼‰é æ¸¬åœ–ç‰‡ (æˆªåœ–)
                    </button>
                    <button onclick="resetRanking()" class="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-3 px-4 rounded-lg shadow-md transition duration-150">
                        é‡è¨­æ’å
                    </button>
                    <button onclick="savePrediction()" class="w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-3 px-4 rounded-lg shadow-md transition duration-150">
                        å„²å­˜æˆ‘çš„é æ¸¬ (ç€è¦½å™¨)
                    </button>
                </div>

                <!-- è¨Šæ¯é¡¯ç¤ºå€ -->
                <div id="message-box" class="mt-4 p-3 text-sm rounded-lg text-center hidden"></div>

            </div>
        </div>
    </div>
    <!-- æˆªåœ–ç›®æ¨™å€åŸŸçµæŸ -->

    <script>
        // F1 2026 é æœŸåƒè³½è»ŠéšŠåˆ—è¡¨
        const TEAMS = [
            { id: 'RBR', name: 'Red Bull Racing', color: 'bg-blue-600', text: 'text-white', logoText: 'R', drivers: 'Max Verstappen & Isack Hadjar' },
            { id: 'MER', name: 'Mercedes', color: 'bg-gray-400', text: 'text-black', logoText: 'M', drivers: 'George Russell & Kimi Antonelli' },
            { id: 'FER', name: 'Ferrari', color: 'bg-red-600', text: 'text-white', logoText: 'F', drivers: 'Charles Leclerc & Lewis Hamilton' },
            { id: 'MCL', name: 'McLaren', color: 'bg-orange-500', text: 'text-white', logoText: 'M', drivers: 'Lando Norris & Oscar Piastri' },
            { id: 'AST', name: 'Aston Martin', color: 'bg-green-700', text: 'text-white', logoText: 'A', drivers: 'Fernando Alonso & Lance Stroll' },
            { id: 'ALP', name: 'Alpine', color: 'bg-pink-700', text: 'text-white', logoText: 'A', drivers: 'Pierre Gasly & Franco Colapinto' },
            { id: 'AUD', name: 'Audi', color: 'bg-white', text: 'text-black', border: 'border border-gray-300', logoText: 'A', drivers: 'Nico Hulkenberg & Gabriel Bortoleto' }, // Kick Sauber è½‰å‹
            { id: 'WIL', name: 'Williams Racing', color: 'bg-blue-900', text: 'text-white', logoText: 'W', drivers: 'Alex Albon & Carlos Sainz' },
            { id: 'HAA', name: 'Haas', color: 'bg-gray-800', text: 'text-white', logoText: 'H', drivers: 'Esteban Ocon & Ollie Bearman' },
            { id: 'RB', name: 'Racing Bulls', color: 'bg-red-400', text: 'text-white', logoText: 'R', drivers: 'Liam Lawson & Arvid Lindblad' },
            { id: 'CAD', name: 'Cadillac', color: 'bg-black', text: 'text-white', logoText: 'C', drivers: 'Valtteri Bottas & Sergio Perez' } // æ–°è»ŠéšŠ
        ];

        const RANKING_COUNT = 11; 
        
        let draggedId = null; // å„²å­˜ç•¶å‰æ‹–æ›³çš„å¡ç‰‡ ID

        document.addEventListener('DOMContentLoaded', () => {
            initializeApp();
        });

        // --- æ‹–æ›³è¼”åŠ©å‡½æ•¸ ---

        /**
         * å°‡å¡ç‰‡æŒ‰ TEAMS é™£åˆ—ä¸­çš„åŸå§‹é †åºæ’å…¥åˆ°æœªæ’åå€ã€‚
         * @param {HTMLElement} card - è¦æ’å…¥çš„è»ŠéšŠå¡ç‰‡
         */
        function insertCardIntoUnrankedSorted(card) {
            const cardOriginalIndex = TEAMS.findIndex(t => t.id === card.id);
            const unrankedContainer = document.getElementById('unranked-teams');
            const unrankedChildren = Array.from(unrankedContainer.children).filter(child => child.id !== card.id);

            let insertBeforeNode = null;
            for (let i = 0; i < unrankedChildren.length; i++) {
                const unrankedTeamId = unrankedChildren[i].id;
                const unrankedTeamIndex = TEAMS.findIndex(t => t.id === unrankedTeamId);
                
                // å°‹æ‰¾æ¯”ç•¶å‰å¡ç‰‡åŸå§‹ç´¢å¼•å¤§çš„ç¬¬ä¸€å€‹å¡ç‰‡ä½œç‚ºæ’å…¥é»
                if (unrankedTeamIndex > cardOriginalIndex) {
                    insertBeforeNode = unrankedChildren[i];
                    break;
                }
            }

            // ç¢ºä¿å¡ç‰‡å¾ç•¶å‰ä½ç½®ç§»é™¤ï¼ˆå¦‚æœå®ƒåœ¨ DOM ä¸­ï¼‰
            if (card.parentElement) {
                card.parentElement.removeChild(card);
            }

            if (insertBeforeNode) {
                unrankedContainer.insertBefore(card, insertBeforeNode);
            } else {
                unrankedContainer.appendChild(card); 
            }
        }

        // --- åŸç”Ÿæ‹–æ›³äº‹ä»¶è™•ç† ---

        function handleDragStart(e) {
            const card = e.currentTarget;
            draggedId = card.id;
            e.dataTransfer.setData('text/plain', draggedId);
            
            // è¨­å®šæ‹–æ›³è¦–è¦ºæ•ˆæœï¼šè®“åŸå§‹å¡ç‰‡è®Šé€æ˜
            setTimeout(() => card.classList.add('drag-source'), 0);
        }

        function handleDragEnd(e) {
            e.currentTarget.classList.remove('drag-source');
            draggedId = null;
        }

        function handleDragOver(e) {
            // é˜»æ­¢é è¨­è™•ç†ï¼Œä»¥å…è¨±æ”¾ç½®
            e.preventDefault(); 
            // è¦–è¦ºå›é¥‹
            if (e.currentTarget.classList.contains('drop-target')) {
                e.currentTarget.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            // ç§»é™¤è¦–è¦ºå›é¥‹
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');

            const targetSlot = e.currentTarget;
            const cardId = draggedId;
            const card = document.getElementById(cardId);
            
            if (!card || !targetSlot) return;

            // è™•ç†æ”¾ç½®é‚è¼¯
            if (targetSlot.id.startsWith('rank-')) {
                // ç›®æ¨™æ˜¯æ’åç©ºä½
                const existingCard = targetSlot.querySelector('.team-card');
                
                // æª¢æŸ¥ card æ˜¯å¦ä¾†è‡ªç•¶å‰ç›®æ¨™ (é˜²æ­¢é‡è¤‡æ“ä½œ)
                if (existingCard === card) return;

                if (existingCard) {
                    // äº¤æ›é‚è¼¯ï¼šå°‡èˆŠå¡ç‰‡é€å›æœªæ’åå€ï¼Œå°‡æ–°å¡ç‰‡æ”¾å…¥ç©ºä½
                    
                    // èˆŠå¡ç‰‡æœƒè¢«æ›¿æ›ï¼Œå°‡å…¶å–å‡ºä¸¦æ’åº
                    if (existingCard.parentElement) {
                        existingCard.parentElement.removeChild(existingCard);
                    }
                    insertCardIntoUnrankedSorted(existingCard); 
                    targetSlot.appendChild(card); 
                    
                } else {
                    // ç©ºä½ï¼šç›´æ¥æ”¾å…¥
                    targetSlot.appendChild(card); 
                }
            } else if (targetSlot.id === 'unranked-teams') {
                // ç›®æ¨™æ˜¯æœªæ’åå€ (å°‡å¡ç‰‡æ’å›åŸå§‹æ’åºä½ç½®)
                insertCardIntoUnrankedSorted(card); 
            }
            
            showMessage('æ’åå·²æ›´æ–°ï¼', 'bg-blue-100 text-blue-800');
        }

        // --- åˆå§‹åŒ–å’Œé é¢é‚è¼¯ ---

        function initializeApp() {
            createRankingSlots();
            createTeamCards(TEAMS, 'unranked-teams');
            loadPrediction(); 
            
            // é‡å°æ‰€æœ‰æ”¾ç½®å€åŸŸæ·»åŠ ç›£è½å™¨
            const dropTargets = document.querySelectorAll('.drop-target, #unranked-teams');
            dropTargets.forEach(target => {
                target.addEventListener('dragover', handleDragOver);
                target.addEventListener('dragleave', handleDragLeave);
                target.addEventListener('drop', handleDrop);
            });
        }
        
        function createRankingSlots() {
            const slotsContainer = document.getElementById('ranking-slots');
            const rankSuffixes = ['st', 'nd', 'rd', 'th', 'th', 'th', 'th', 'th', 'th', 'th', 'th'];
            
            for (let i = 1; i <= RANKING_COUNT; i++) {
                const rankText = `${i}${rankSuffixes[i - 1]}`;
                
                const slotDiv = document.createElement('div');
                slotDiv.id = `rank-${i}`;
                slotDiv.className = 'drop-target p-3 bg-gray-100 border-2 border-dashed border-gray-300 rounded-lg flex items-center min-h-[70px] transition-colors';
                slotDiv.innerHTML = `<span class="text-lg font-bold text-gray-500 mr-2 w-12 flex-shrink-0">${rankText}</span>`;

                slotsContainer.appendChild(slotDiv);
            }
        }

        function createTeamCards(teams, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = ''; 

            teams.forEach(team => {
                const card = document.createElement('div');
                card.id = team.id;
                
                // å•Ÿç”¨åŸç”Ÿ Drag and Drop
                card.draggable = true; 
                
                card.className = `team-card bg-white text-gray-900 ${team.border || ''} p-2 flex-grow rounded-lg shadow-md overflow-hidden`;
                
                const logoBgColor = team.color; 
                const logoTextColor = team.text; 
                
                const logoHtml = `
                    <div class="h-8 w-8 rounded-full flex items-center justify-center border-2 border-transparent ${logoBgColor} ${logoTextColor} shadow-inner flex-shrink-0">
                        <span class="text-sm font-extrabold">
                            ${team.logoText}
                        </span>
                    </div>
                `;
                
                const driversArray = team.drivers.split(' & ');
                const driver1 = driversArray[0] || '';
                const driver2 = driversArray[1] || '';

                card.innerHTML = `
                    <div class="team-info-container space-x-2">
                        ${logoHtml}
                        <div class="team-info gap-1">
                            <span class="text-sm font-bold whitespace-nowrap">${team.name}</span>
                            <div class="driver-names">
                                <span class="text-xs text-gray-500 font-medium block">${driver1}</span>
                                <span class="text-xs text-gray-500 font-medium block">${driver2}</span>
                            </div>
                        </div>
                    </div>
                `;

                // è¨»å†ŠåŸç”Ÿæ‹–æ›³äº‹ä»¶
                card.addEventListener('dragstart', handleDragStart);
                card.addEventListener('dragend', handleDragEnd);
                
                container.appendChild(card);
            });
        }
        
        function resetRanking() {
            const allTeams = [...document.querySelectorAll('.team-card')];
            const unrankedContainer = document.getElementById('unranked-teams');
            
            const sortedTeams = allTeams.sort((a, b) => {
                const teamA = TEAMS.find(t => t.id === a.id);
                const teamB = TEAMS.find(t => t.id === b.id);
                return TEAMS.indexOf(teamA) - TEAMS.indexOf(teamB);
            });

            sortedTeams.forEach(card => {
                if(card.parentElement) {
                    card.parentElement.removeChild(card);
                }
                unrankedContainer.appendChild(card);
            });

            localStorage.removeItem('f1_2026_ranking');
            showMessage('æ’åå·²é‡è¨­ã€‚', 'bg-red-100 text-red-800');
        }

        function savePrediction() {
            const ranking = [];
            for (let i = 1; i <= RANKING_COUNT; i++) {
                const slot = document.getElementById(`rank-${i}`);
                const teamCard = slot.querySelector('.team-card');
                
                if (teamCard) {
                    ranking.push({ rank: i, teamId: teamCard.id });
                } else {
                    ranking.push({ rank: i, teamId: null }); 
                }
            }
            
            localStorage.setItem('f1_2026_ranking', JSON.stringify(ranking));
            showMessage('é æ¸¬æ’åå·²å„²å­˜åˆ°æ‚¨çš„ç€è¦½å™¨ï¼', 'bg-green-100 text-green-800');
        }

        function loadPrediction() {
            const storedRanking = localStorage.getItem('f1_2026_ranking');
            if (!storedRanking) return;

            const ranking = JSON.parse(storedRanking);
            let teamsToKeep = [...TEAMS.map(t => t.id)]; 

            ranking.forEach(item => {
                if (item.teamId) {
                    const teamCard = document.getElementById(item.teamId);
                    const targetSlot = document.getElementById(`rank-${item.rank}`);
                    
                    if (teamCard && targetSlot) {
                        if (teamCard.parentElement) {
                            teamCard.parentElement.removeChild(teamCard);
                        }
                        targetSlot.appendChild(teamCard);
                        
                        teamsToKeep = teamsToKeep.filter(id => id !== item.teamId);
                    }
                }
            });

            const unrankedContainer = document.getElementById('unranked-teams');
            unrankedContainer.innerHTML = '';
            const unrankedTeamsData = TEAMS.filter(team => teamsToKeep.includes(team.id));
            createTeamCards(unrankedTeamsData, 'unranked-teams');
            
            showMessage('å·²è¼‰å…¥æ‚¨ä¸Šæ¬¡å„²å­˜çš„æ’åï¼', 'bg-yellow-100 text-yellow-800');
        }

        function capturePrediction() {
            const captureArea = document.getElementById('capture-target');
            const buttonsContainer = document.querySelector('.hidden-on-screenshot');
            
            buttonsContainer.classList.add('hide');
            
            showMessage('æ­£åœ¨ç”Ÿæˆåœ–ç‰‡ï¼Œè«‹ç¨å€™...', 'bg-blue-100 text-blue-800');
            
            html2canvas(captureArea, { 
                scale: window.devicePixelRatio * 2, 
                useCORS: true,
                allowTaint: true 
            }).then(canvas => {
                const image = canvas.toDataURL('image/png');
                const link = document.createElement('a');
                link.download = 'F1_2026_Ranking_Prediction.png';
                link.href = image;
                link.click();

                showMessage('é æ¸¬åœ–ç‰‡å·²æˆåŠŸä¸‹è¼‰ï¼', 'bg-green-100 text-green-800');
            }).catch(error => {
                console.error('æˆªåœ–å¤±æ•—:', error);
                showMessage('æˆªåœ–å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç€è¦½å™¨è¨­å®šæˆ–é‡æ–°å˜—è©¦ã€‚', 'bg-red-100 text-red-800');
            }).finally(() => {
                buttonsContainer.classList.remove('hide');
            });
        }

        function showMessage(text, className) {
            const msgBox = document.getElementById('message-box');
            msgBox.textContent = text;
            msgBox.className = `mt-4 p-3 text-sm rounded-lg text-center ${className}`;
            msgBox.classList.remove('hidden');
            
            setTimeout(() => {
                msgBox.classList.add('hidden');
            }, 5000);
        }
    </script>

</body>
</html>
